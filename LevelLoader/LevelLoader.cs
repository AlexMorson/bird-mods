using System.Collections.Generic;
using BepInEx;
using UnityEngine;

namespace LevelLoader
{
    [BepInPlugin("com.alexmorson.levelloader", "LevelLoader", "1.0")]
    public class LevelLoader : BaseUnityPlugin
    {
        private Vector.VectorManager custom, original;
        private List<GameObject> polygons = new List<GameObject>();

        private Vector CreateBox(double left, double right, double bottom, double top, bool invert = false)
        {
            var x1 = invert ? left : right;
            var x2 = invert ? right : left;
            custom.Add(x1, top, x2, top);
            custom.Add(x2, top, x2, bottom);
            custom.Add(x2, bottom, x1, bottom);
            return custom.Add(x1, bottom, x1, top);
        }

        private void Awake()
        {
            custom = new Vector.VectorManager();
            original = LayerManager.Manager.PlayerLayer.vectors;
            foreach (var layer in LayerManager.Manager.Layers)
            {
                foreach (var polygon in layer.Art)
                {
                    Destroy(polygon.transform.gameObject);
                }
            }

            int[][] loops = {
                new[] {8452, 10000, 8452, 9280, 8524, 9280, 8596, 9244, 9064, 9244, 9136, 9208, 9136, 9136, 9172, 9064, 9532, 8704, 9532, 8272, 9568, 8236, 10216, 8236, 10216, 8200, 10900, 8200, 10900, 8164, 11116, 7948, 11188, 7912, 11224, 7876, 11440, 7768, 11476, 7732, 11620, 7660, 11656, 7660, 11728, 7624, 12052, 7624, 12124, 7660, 12160, 7696, 12664, 7696, 12736, 7732, 13816, 7732, 13816, 7552, 14464, 6904, 14464, 6868, 15724, 6868, 15724, 6832, 15976, 6832, 15976, 6760, 17092, 6760, 17092, 6724, 17128, 6724, 17128, 6508, 17632, 6508, 17632, 6040, 18640, 6040, 18640, 5428, 20296, 5428, 20296, 5212, 20224, 5212, 20224, 5284, 20152, 5284, 20152, 5320, 20080, 5320, 20080, 5284, 20044, 5284, 20044, 5248, 19936, 5248, 19936, 5320, 19828, 5320, 19828, 5356, 19792, 5356, 19792, 5248, 19720, 5248, 19720, 5284, 19684, 5284, 19684, 5356, 19504, 5356, 19504, 5320, 19468, 5320, 19468, 5284, 19360, 5284, 19360, 5320, 19288, 5320, 19288, 5356, 19216, 5356, 19216, 5284, 19180, 5284, 19180, 5320, 19144, 5320, 19144, 5356, 18928, 5356, 18928, 5284, 18892, 5284, 18892, 5320, 18856, 5320, 18856, 5356, 18712, 5356, 18712, 5320, 18640, 5320, 18640, 5212, 18604, 5212, 18604, 5140, 18568, 5140, 18568, 5788, 18496, 5824, 18316, 5824, 18244, 5860, 18208, 5896, 18100, 5896, 18028, 5932, 17632, 5932, 17560, 5968, 17524, 5968, 17452, 6004, 17380, 6004, 17380, 6076, 17236, 6076, 17236, 6436, 17128, 6436, 17128, 6040, 17092, 6040, 17092, 6112, 17056, 6112, 16984, 6148, 16948, 6148, 16876, 6184, 16840, 6184, 16624, 6292, 16552, 6292, 16264, 6436, 16156, 6436, 16084, 6472, 16048, 6472, 15976, 6508, 15760, 6508, 15688, 6544, 15616, 6616, 15544, 6616, 15544, 6652, 15508, 6688, 15436, 6724, 15364, 6796, 15292, 6832, 14392, 6832, 14392, 6904, 13780, 7516, 13600, 7516, 13528, 7552, 13384, 7552, 13312, 7588, 13276, 7516, 13132, 7372, 13060, 7336, 12880, 7336, 12808, 7372, 12736, 7336, 12448, 7336, 12448, 7354, 12412, 7336, 12268, 7336, 12268, 7354, 12232, 7336, 12088, 7336, 12016, 7300, 11692, 7300, 11692, 7318, 11656, 7300, 11584, 7300, 11512, 7336, 11440, 7336, 11368, 7372, 11296, 7372, 11224, 7408, 11152, 7408, 11080, 7444, 11044, 7480, 11044, 7516, 11008, 7516, 10936, 7588, 10864, 7732, 10864, 7768, 10684, 7768, 10612, 7732, 10468, 7732, 10468, 7750, 10432, 7732, 10288, 7732, 10216, 7768, 10144, 7840, 10108, 7840, 10108, 7876, 10036, 7876, 9892, 7948, 9712, 7948, 9712, 7966, 9676, 7948, 9604, 7948, 9532, 7984, 9424, 7984, 9388, 7948, 9316, 7912, 9244, 7912, 9100, 7984, 9064, 8020, 8992, 8056, 8920, 8128, 8920, 8164, 8884, 8164, 8812, 8200, 8740, 8272, 8668, 8416, 8632, 8452, 8560, 8596, 8524, 8632, 8488, 8704, 8488, 8740, 8452, 8812, 8452, 7048, 8272, 7048, 8272, 7084, 8164, 7084, 8164, 9064, 8128, 9136, 8128, 9172, 8164, 9172, 8164, 11152, 8308, 11152, 8308, 11440, 8452, 11440 },
                new[] {9964, 8344, 9820, 8344, 9748, 8380, 9640, 8380, 9640, 8614, 9676, 8596, 11116, 8596, 11188, 8560, 11908, 7840, 11944, 7840, 11944, 7804, 11908, 7768, 11764, 7768, 11692, 7804, 11656, 7804, 11440, 7912, 11404, 7948, 11332, 7984, 11296, 8020, 11260, 8020, 11188, 8056, 11152, 8092, 11080, 8128, 11044, 8200, 10936, 8308, 10864, 8308, 10864, 8272, 10792, 8272, 10792, 8344, 10756, 8344, 10756, 8380, 10720, 8380, 10720, 8416, 10216, 8416, 10216, 8380, 10180, 8380, 10180, 8344 },
                new[] {9316, 8668, 9316, 8740, 9208, 8740, 9208, 8668 },
                new[] {24202, 10000, 24220, 9964, 24220, 9784, 24184, 9712, 24184, 9640, 24220, 9640, 24220, 9604, 24256, 9604, 24328, 9568, 24364, 9568, 24400, 9532, 24436, 9532, 24508, 9496, 24544, 9496, 24616, 9460, 24652, 9460, 24652, 9568, 24724, 9640, 24796, 9640, 24904, 9532, 24904, 9496, 24976, 9352, 25012, 9316, 25012, 9172, 25084, 9100, 25156, 9100, 25228, 9028, 25228, 8920, 25264, 8884, 25264, 8776, 25246, 8776, 25264, 8740, 25264, 8524, 25228, 8452, 25228, 8416, 25192, 8380, 25156, 8308, 25048, 8200, 25048, 8128, 25012, 8092, 25012, 7984, 24976, 7912, 24976, 7624, 24904, 7552, 23788, 7552, 23788, 7516, 23752, 7516, 23752, 7228, 23716, 7192, 23716, 7084, 23680, 7048, 23608, 7120, 23608, 6292, 23536, 6292, 23536, 6904, 22960, 6904, 22960, 6652, 22888, 6652, 22888, 6904, 22312, 6904, 22312, 6976, 23536, 6976, 23536, 7192, 23500, 7264, 23536, 7264, 23536, 7480, 23500, 7552, 23536, 7552, 23536, 7732, 24040, 7732, 24040, 7696, 24184, 7696, 24256, 7732, 24472, 7732, 24544, 7696, 24760, 7696, 24760, 8056, 24688, 8200, 24652, 8236, 24616, 8236, 24616, 8272, 24544, 8308, 24508, 8308, 24436, 8380, 24436, 8416, 24508, 8488, 24760, 8488, 24760, 9136, 24724, 9172, 24688, 9244, 24652, 9280, 24508, 9352, 24472, 9352, 24400, 9388, 24364, 9388, 24328, 9424, 24256, 9424, 24184, 9460, 24076, 9460, 24040, 9424, 23968, 9280, 23860, 9172, 23788, 9172, 23752, 9208, 23716, 9136, 23680, 9100, 23680, 8992, 23644, 8956, 23680, 8920, 23680, 8884, 23860, 8884, 23896, 8848, 23932, 8848, 24004, 8776, 24220, 8776, 24256, 8740, 24436, 8740, 24508, 8668, 24436, 8596, 24292, 8596, 24292, 8272, 24328, 8236, 24364, 8164, 24364, 8056, 24256, 7948, 24184, 7948, 24076, 8056, 24076, 8092, 24040, 8164, 24040, 7912, 24004, 7876, 23968, 7876, 23968, 8236, 23824, 8524, 23320, 8524, 23320, 9532, 23752, 9532, 23896, 9676, 23896, 9820, 23860, 9856, 23860, 9892, 23788, 9928, 23716, 10000, 23680, 10000, 23644, 9964, 23608, 10000, 23536, 10036, 23464, 10036, 23428, 10072, 23212, 10072, 23140, 10000, 23140, 9964, 23068, 10000, 23032, 10036, 22996, 10054, 22996, 10036, 22960, 10036, 22924, 10000, 22888, 10000, 22816, 9964, 22780, 9964, 22780, 9928, 22672, 9820, 22672, 9676, 22816, 9532, 23176, 9532, 23176, 8308, 23392, 8308, 23392, 7660, 23320, 7660, 23248, 7588, 23176, 7588, 23068, 7696, 23068, 7732, 22960, 7840, 22888, 7876, 22852, 7876, 22816, 7912, 22744, 7948, 22492, 7948, 22420, 7912, 22312, 7804, 22276, 7732, 22240, 7696, 22240, 7660, 22222, 7660, 22204, 7624, 22168, 7588, 22096, 7552, 22060, 7516, 21988, 7480, 21952, 7444, 21700, 7444, 21628, 7408, 21340, 7408, 21268, 7444, 21232, 7444, 21160, 7480, 20980, 7480, 20836, 7552, 20800, 7552, 20728, 7588, 20692, 7552, 20512, 7552, 20440, 7516, 20152, 7516, 20080, 7480, 20008, 7480, 19936, 7336, 19864, 7300, 19792, 7300, 19720, 7336, 19612, 7336, 19576, 7300, 19540, 7300, 19504, 7264, 19468, 7300, 19432, 7300, 19396, 7336, 19288, 7336, 19216, 7372, 19180, 7408, 19180, 7516, 19216, 7552, 19540, 7552, 19612, 7588, 19648, 7588, 19684, 7552, 19720, 7552, 19828, 7606, 19828, 7624, 19864, 7624, 19900, 7660, 20188, 7660, 20224, 7696, 20332, 7696, 20404, 7732, 20440, 7696, 20656, 7696, 20692, 7714, 20692, 7732, 20764, 7732, 20908, 7660, 20944, 7660, 21016, 7624, 21196, 7624, 21232, 7696, 21268, 7732, 21340, 7768, 21592, 7768, 21664, 7804, 21808, 7804, 21844, 7822, 21844, 7840, 21880, 7840, 21880, 7876, 21916, 7876, 21916, 7912, 21952, 7912, 21988, 7984, 22096, 8092, 22132, 8164, 22204, 8236, 22204, 8272, 22222, 8272, 22240, 8308, 22240, 8380, 22258, 8380, 22168, 8560, 22168, 8632, 22204, 8668, 22204, 8740, 22168, 8776, 22168, 8812, 22060, 9028, 22060, 9280, 21988, 9352, 21988, 9424, 21880, 9532, 21880, 9712, 21916, 9784, 21916, 10072, 21952, 10144, 21988, 10180, 21988, 10288, 22060, 10432, 22168, 10540, 22240, 10576, 22276, 10576, 22348, 10612, 22384, 10612, 22456, 10648, 22744, 10648, 22816, 10684, 23248, 10684, 23284, 10648, 23356, 10612, 23392, 10612, 23536, 10540, 23608, 10540, 23716, 10648, 23824, 10648, 24112, 10360, 24184, 10216, 24184, 10036 },
                new[] {22060, 3196, 22024, 3196, 22024, 3268, 22096, 3268, 22096, 3196 },
                new[] {23572, 5248, 23536, 5248, 23536, 6076, 22384, 6076, 22384, 5968, 22456, 6004, 22528, 6004, 22600, 5968, 22672, 5896, 22708, 5824, 22708, 5572, 22672, 5500, 22672, 5464, 22636, 5392, 22636, 5356, 22618, 5356, 22564, 5248, 22492, 5176, 22420, 5140, 22168, 5140, 22096, 5104, 22024, 5104, 21952, 5140, 21880, 5104, 21736, 5104, 21736, 5122, 21700, 5104, 21556, 5104, 21556, 5122, 21520, 5104, 21196, 5104, 21160, 5122, 21160, 5104, 21124, 5104, 21052, 5068, 20872, 5068, 20800, 5104, 20764, 5140, 20620, 5212, 20548, 5284, 20476, 5320, 20440, 5356, 20296, 5428, 20440, 5428, 20440, 5464, 20512, 5464, 20512, 5824, 20368, 5824, 20368, 5608, 20044, 5608, 19972, 5644, 19900, 5716, 18784, 5716, 18784, 6292, 18856, 6364, 18856, 6580, 18820, 6616, 18820, 6652, 18784, 6688, 18640, 6688, 18604, 6652, 18604, 6616, 18568, 6580, 18568, 6328, 18640, 6256, 18640, 6112, 17956, 6112, 17956, 6148, 17776, 6148, 17776, 6184, 17740, 6184, 17740, 6436, 17956, 6436, 17956, 6832, 17632, 6832, 17632, 6616, 17200, 6616, 17200, 6832, 17056, 6832, 17056, 7120, 16660, 7120, 16660, 6868, 16228, 6868, 16228, 6940, 15832, 6940, 15832, 7624, 15616, 7624, 15616, 7012, 15004, 7012, 14860, 7084, 14824, 7084, 14752, 7120, 14716, 7120, 14572, 7192, 14500, 7264, 14428, 7300, 14392, 7336, 14320, 7372, 14212, 7480, 14140, 7480, 14068, 7516, 13960, 7516, 13960, 7912, 14464, 7912, 14464, 8272, 14356, 8380, 13924, 8380, 13816, 8272, 13816, 7912, 12880, 7912, 12880, 9298, 12916, 9316, 13060, 9316, 13132, 9280, 13168, 9280, 13240, 9244, 13384, 9100, 13420, 9100, 13420, 9082, 13456, 9100, 13744, 9100, 13780, 9136, 13852, 9172, 14212, 9172, 14284, 9136, 14464, 9136, 14464, 9100, 14500, 9064, 14536, 9046, 14536, 9388, 14608, 9388, 14608, 8992, 14680, 8920, 14680, 8740, 14644, 8704, 14644, 8668, 13636, 8668, 13636, 8524, 14608, 8524, 14680, 8488, 15112, 8056, 15184, 8020, 15220, 8020, 15292, 8056, 15328, 7984, 15364, 7984, 15364, 8056, 15436, 8056, 15508, 8020, 16048, 7480, 16120, 7444, 16156, 7444, 16156, 7372, 16876, 7372, 16876, 7264, 17056, 7264, 17092, 7300, 17092, 7408, 17128, 7408, 17200, 7372, 17452, 7120, 17524, 7084, 17920, 7084, 17920, 6976, 18100, 6976, 18136, 7048, 18208, 7012, 18460, 6760, 18532, 6724, 18964, 6724, 18964, 6652, 19288, 6652, 19324, 6688, 19252, 6832, 19252, 6904, 19324, 6904, 19396, 6868, 19828, 6868, 19828, 6796, 20080, 6796, 20080, 6832, 20116, 6904, 20116, 6976, 20080, 7012, 20080, 7048, 20260, 7048, 20332, 7012, 21484, 5860, 21772, 5860, 21808, 5896, 21808, 5968, 21880, 5968, 21880, 5896, 21916, 5860, 22240, 5860, 22276, 5896, 22312, 5896, 22312, 6436, 21304, 6436, 21304, 6508, 21736, 6508, 21736, 6688, 21808, 6688, 21808, 6508, 21880, 6508, 21880, 6832, 21952, 6832, 21952, 6508, 22960, 6508, 22960, 6148, 23608, 6148, 23608, 5248 },
                new[] {21232, 5752, 21232, 6040, 21088, 6184, 21016, 6184, 21016, 5896, 21088, 5860, 21196, 5752 },
                new[] {21340, 5824, 21340, 5896, 21304, 5932, 21304, 5788 },
                new[] {20944, 5968, 20944, 6328, 20800, 6472, 20728, 6472, 20728, 6112, 20836, 6004, 20908, 5968, 20944, 5932 },
                new[] {22888, 6148, 22888, 6436, 22384, 6436, 22384, 6148 },
                new[] {20656, 6148, 20656, 6616, 20512, 6760, 20440, 6760, 20440, 6220, 20512, 6184, 20548, 6184, 20620, 6148 },
                new[] {20368, 6292, 20368, 6832, 20296, 6832, 20296, 6868, 20224, 6796, 20224, 6760, 20296, 6688, 20296, 6472, 20332, 6400, 20332, 6328, 20314, 6328, 20332, 6292, 20368, 6256 },
                new[] {19720, 6544, 19756, 6580, 19756, 6616, 19720, 6688, 19684, 6724, 19684, 6796, 19648, 6832, 19504, 6832, 19468, 6796, 19468, 6724, 19432, 6688, 19432, 6580, 19504, 6544 },
                new[] {26308, 6904, 25696, 6904, 25696, 6976, 26344, 6976, 26344, 6904 },
                new[] {25228, 6616, 23896, 6616, 23896, 6688, 25192, 6688, 25192, 7228, 24652, 7228, 24652, 7300, 25264, 7300, 25264, 6616 },
                new[] {24976, 6976, 24940, 6976, 24976, 7012, 25012, 6976 },
                new[] {24868, 6868, 24832, 6868, 24832, 6904, 24868, 6868, 24904, 6904, 24904, 6868 },
                new[] {24760, 6976, 24724, 6976, 24760, 7012, 24796, 6976 },
                new[] {26200, 7156, 26164, 7156, 26164, 7228, 26236, 7228, 26236, 7156 },
                new[] {23644, 7624, 23680, 7660, 23608, 7660, 23608, 7588 },
                new[] {23572, 7948, 23536, 7948, 23536, 8236, 23608, 8236, 23608, 7948 },
                new[] {23320, 8164, 23320, 8236, 23212, 8236, 23320, 8128 },
                new[] {19324, 7768, 19108, 7768, 19036, 7840, 18964, 7876, 18856, 7876, 18820, 7840, 18784, 7840, 18712, 7804, 18640, 7804, 18568, 7768, 18496, 7696, 18424, 7660, 18388, 7624, 18352, 7552, 18352, 7444, 18316, 7408, 18316, 7264, 18280, 7228, 18280, 7156, 18244, 7120, 17956, 7264, 17920, 7300, 17920, 7336, 17956, 7372, 17956, 7552, 17920, 7624, 17848, 7696, 17848, 7732, 17812, 7768, 17812, 7840, 17884, 7840, 17956, 7912, 17956, 7948, 18064, 8056, 18280, 8164, 18424, 8164, 18460, 8128, 18784, 8128, 18820, 8092, 19072, 8092, 19144, 8056, 19180, 8020, 19252, 7984, 19324, 7984, 19396, 7912, 19396, 7840 },
                new[] {23500, 8596, 23428, 8668, 23392, 8632, 23392, 8596 },
                new[] {22816, 8668, 22924, 8776, 22924, 8884, 22816, 8992, 22816, 9028, 22636, 9208, 22492, 9208, 22456, 9172, 22456, 9136, 22420, 9172, 22348, 9316, 22348, 9334, 22456, 9388, 22456, 9424, 22384, 9496, 22456, 9568, 22420, 9604, 22240, 9604, 22132, 9496, 22132, 9352, 22096, 9316, 22132, 9280, 22132, 9208, 22168, 9136, 22420, 8884, 22492, 8884, 22492, 8848, 22528, 8848, 22672, 8704, 22708, 8704, 22744, 8668 },
                new[] {23428, 9424, 23464, 9460, 23392, 9460, 23392, 9388 },
                new[] {23104, 9460, 23068, 9460, 23104, 9424 },
                new[] {12736, 10000, 12736, 8020, 12664, 8056, 12484, 8056, 12412, 8020, 12376, 7984, 12340, 8056, 12340, 8272, 12358, 8272, 12340, 8308, 12340, 8524, 12358, 8524, 12340, 8560, 12340, 8704, 12376, 8776, 12376, 8848, 12412, 8920, 12484, 8992, 12520, 9064, 12664, 9208, 12664, 10000, 12628, 10036, 12628, 10072, 12664, 10072, 12664, 11260, 12736, 11260 },
                new[] {17416, 7048, 17416, 7084, 17272, 7228, 17200, 7228, 17200, 7048 },
                new[] {15220, 7552, 15220, 7660, 15184, 7696, 15112, 7696, 15112, 7552 },
                new[] {14968, 7696, 14968, 7984, 15040, 7984, 15040, 8056, 14896, 8200, 14824, 8200, 14824, 7696 },
                new[] {15616, 7804, 15616, 7840, 15544, 7912, 15472, 7912, 15472, 7804 },
                new[] {13600, 8200, 13636, 8236, 13672, 8236, 13708, 8308, 13672, 8344, 13636, 8344, 13600, 8380, 13564, 8380, 13528, 8308, 13528, 8200 },
            };

            foreach (var loop in loops)
            {
                var n = loop.Length / 2;
                for (var i = 0; i < n - 1; ++i)
                {
                    var x1 = loop[2 * i];
                    var y1 = loop[2 * i + 1];
                    var x2 = loop[2 * i + 2];
                    var y2 = loop[2 * i + 3];
                    custom.Add(x1, y1, x2, y2);
                }

                // var vector = custom.Add(loop[0], loop[1], loop[2 * n - 2], loop[2 * n - 1]);
                var vector = custom.Add(loop[2 * n - 2], loop[2 * n - 1], loop[0], loop[1]);
                polygons.Add(Polygon.CreatePolygon(vector, false));
            }

            LayerManager.Manager.PlayerLayer.vectors = custom;
            MasterController.GetPlayer().Position = new Coord(10000 + 5000 * 3 / 4, 10000 - 1900 * 3 / 4);
        }

        private void OnDestroy()
        {
            LayerManager.Manager.PlayerLayer.vectors = original;
            foreach (var polygon in polygons)
            {
                Destroy(polygon);
            }

            polygons.Clear();
        }
    }
}
